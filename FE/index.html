<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookStore - Trang chủ</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Tùy chỉnh nhỏ */
        .product-card img {
            height: 300px;
            object-fit: cover;
        }
    </style>
</head>

<body>

    <!-- 1. Header (Navbar) -->
    <div id="navbar-placeholder"></div>

    <!-- 2. Hero Banner (Carousel) -->
    <header class="container my-4">
        <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active"
                    aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
            </div>
            <div class="carousel-inner rounded">
                <div class="carousel-item active">
                    <img src="https://placehold.co/1200x400/343a40/ffffff?text=Khuyen+Mai+Giam+50%25"
                        class="d-block w-100" alt="Khuyến mãi 1">
                    <div class="carousel-caption d-none d-md-block">
                        <h5>Sách Mới Phát Hành</h5>
                        <p>Giảm giá 50% cho 100 đơn hàng đầu tiên.</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="https://placehold.co/1200x400/6c757d/ffffff?text=Mien+Phi+Van+Chuyen"
                        class="d-block w-100" alt="Khuyến mãi 2">
                    <div class="carousel-caption d-none d-md-block">
                        <h5>Miễn Phí Vận Chuyển</h5>
                        <p>Cho mọi đơn hàng từ 200.000đ.</p>
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </header>

    <!-- Nội dung chính -->
    <main class="container">

        <!-- 3. Danh mục nổi bật -->
        <section class="my-5">
            <h2 class="text-center mb-4">Danh Mục Nổi Bật</h2>
            <!-- [CSDL] Lấy từ bảng Categories (name, slug) -->
            <div id="featuredCategories" class="row row-cols-2 row-cols-md-3 row-cols-lg-6 g-3">
                <!-- Categories will be populated here -->
                <div class="col-12 text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. Lưới sản phẩm mới nhất -->
        <section class="my-5">
            <h2 class="text-center mb-4">Sách Mới Phát Hành</h2>
            <!-- [CSDL] Lấy từ bảng Products (JOIN Authors) -->
            <div id="newProducts" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
                <!-- Products will be populated here -->
                <div class="col-12 text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- 5. Footer -->
    <div id="footer-placeholder"></div>


    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <!-- Script để tải các thành phần dùng chung -->
    <script src="js/include.js"></script>
    <script src="js/config.js"></script>
    <script src="js/cart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            const productContainer = document.getElementById('newProducts');
            const categoryContainer = document.getElementById('featuredCategories');

            // 1. Fetch Categories
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/products/categories`);
                if (response.ok) {
                    const categories = await response.json();
                    categoryContainer.innerHTML = '';

                    if (categories.length === 0) {
                        categoryContainer.innerHTML = '<p class="text-center w-100">Chưa có danh mục nào.</p>';
                    } else {
                        // Limit to 6 categories for display
                        categories.slice(0, 6).forEach(cat => {
                            const catCard = `
                                <div class="col">
                                    <a href="category.html?id=${cat.id}" class="card h-100 text-decoration-none text-dark text-center shadow-sm">
                                        <div class="card-body p-3">
                                            <i class="fa-solid fa-book fa-2x text-primary mb-2"></i>
                                            <h6 class="card-title mb-0">${cat.name}</h6>
                                        </div>
                                    </a>
                                </div>
                            `;
                            categoryContainer.insertAdjacentHTML('beforeend', catCard);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading categories:', error);
                categoryContainer.innerHTML = '<p class="text-center text-danger w-100">Lỗi tải danh mục.</p>';
            }

            // 2. Fetch Products
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/products/?limit=8`);
                if (response.ok) {
                    const products = await response.json();
                    productContainer.innerHTML = '';

                    if (products.length === 0) {
                        productContainer.innerHTML = '<p class="text-center w-100">Chưa có sản phẩm nào.</p>';
                        return;
                    }

                    products.forEach(product => {
                        const productCard = `
                            <div class="col">
                                <div class="card h-100 shadow-sm product-card">
                                    <img src="${product.image_url || 'https://placehold.co/300x400?text=No+Image'}" class="card-img-top" alt="${product.title}">
                                    <div class="card-body d-flex flex-column">
                                        <h5 class="card-title text-truncate" title="${product.title}">${product.title}</h5>
                                        <!-- Note: Author name is not directly in product list API yet, might need join or separate fetch. 
                                             For now, we might not show author or show 'Unknown' if not in response. 
                                             Let's check response model. It has author_id but not name. 
                                             We should update backend to return author name or fetch it. 
                                             For now, let's hide author or display generic text. -->
                                        <!-- <p class="card-text text-muted mb-2">Tác giả: ...</p> -->
                                        <h6 class="card-subtitle mb-2 text-danger mt-auto pt-2">${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(product.price)}</h6>
                                        <a href="product-detail.html?id=${product.id}" class="btn btn-primary mt-2">Xem chi tiết</a>
                                    </div>
                                </div>
                            </div>
                        `;
                        productContainer.insertAdjacentHTML('beforeend', productCard);
                    });
                }
            } catch (error) {
                console.error('Error loading products:', error);
                productContainer.innerHTML = '<p class="text-center text-danger w-100">Lỗi tải sản phẩm.</p>';
            }
        });
    </script>
</body>

</html>